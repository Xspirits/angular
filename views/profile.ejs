<!doctype html>
<html>
<head>
	<% include statics/headers %>
    <!-- Start General metas -->
    <meta name="url" content="http://www.challenge-friends.com">
    <meta name="language" content="EN">
    <meta name="reply-to" content="cyf.app@gmail.com">
    <meta name="rating" content="General">
    <meta name="keywords" content="profile, challenge, challenge friends, cyf, gaming, competition, e-sport, league of legend, dota, dota 2, champion">
    <meta name="title" content="<%= currentUser.local.pseudo %>'s profile - Challenge your Friends">
    <meta name="description" content="<%= currentUser.local.pseudo %> is a challenger level <%= currentUser.level %> at Challenge your Friends. He/She has <%= currentUser.friends.length %> friend(s).<%= currentUser.twitter.username ? 'twitter @'+currentUser.twitter.username :'' %> ">
    <!-- End General metas -->
    <!-- Start Open Graph metas -->
    <meta property="og:type" content="profile:<%= currentUser.local.idCool %>"> <!-- website/article/profile -->
    <meta property="og:url" content="http://www.challenge-friends.com/u/<%= currentUser.idCool %>">
    <meta property="og:site_name" content="Challenge your Friends"/>
    <meta property="og:image" content="<%= currentUser.icon %>">
    <meta property="og:image:width" content="200">
    <meta property="og:title" content="<%= currentUser.local.pseudo %>'s profile - Challenge your Friends">
    <meta property="og:description" content="<%= currentUser.local.pseudo %> is a challenger level <%= currentUser.level %> at Challenge your Friends. He/She has <%= currentUser.friends.length %> friend(s) <%= currentUser.twitter.username ? 'find him on twitter @'+currentUser.twitter.username :'' %>  ">
    <!-- End Open Graph -->
    <!-- Start Twitter Card Meta -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@cyf_app">
    <meta name="twitter:image" content="<%= currentUser.icon %>">
    <meta name="twitter:image:width" content="200">
    <meta name="twitter:title" content="<%= currentUser.local.pseudo %>'s profile - Challenge your Friends">
    <meta name="twitter:description" content="<%= currentUser.local.pseudo %> is a challenger level <%= currentUser.level %> at Challenge your Friends. He/She has <%= currentUser.friends.length %> friend(s) <%= currentUser.twitter.username ? 'find him on twitter @'+currentUser.twitter.username :'' %>  ">
    <!-- Twitter card end -->
	<title>This is your profile, <%= currentUser.local.pseudo %> - Challenge your Friends</title>
	<link rel="stylesheet" href="./css/timeline.css">

</head>
<body>

	<% include statics/navTop %>
	<% xpPer = Math.round((currentUser.xp/ ( currentUser.xp + currentUser.xpNext) )*100); %>

	<div class="canvas">
		
		<div class="container">
			<div class="row">
				<div id="user_header" class="col-lg-8">
						<div class="row">
							<div class="col-lg-2 col-xs-2 animated fadeInUp" href="#">
									<img src="<%= currentUser.icon %>" class="img-responsive img-rounded">
							</div>
							<h2 class="col-lg-10 animated bounceInUp">
								<%= currentUser.local.pseudo %> 

								<span id="scorebox">
									<span class="level text-center">
										<span class="odometer" data-number="<%= currentUser.level %>">
											0
										</span>
									</span>
								</span>
								<small> <a href="/u/<%= currentUser.idCool %>"> <i class="fa fa-chain"></i> <%= currentUser.idCool %> </a></small>
							</h2>
							<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
										<div class="loaderProgress animated flipInY">
											<div class="tinyProgress tinyBlue" style="width: 0%" data-percent="<%= xpPer %>"></div>

											<div class="xp text-center">
												<%= currentUser.xp %>/<%= (currentUser.xp + currentUser.xpNext) %>
											</div>
										</div>
							</div>
							<div class="col-lg-12">	
								<strong>Linked accounts: </strong>
								<% if (currentUser.local.pseudo) { %>
								<span class="label label-default">CyF</span>
								<% } %>
								<% if (currentUser.facebook.name) { %>
								<span class="label label-primary">Facebook</span>
								<% } %>
								<% if (currentUser.google.name) { %>
								<span class="label label-danger">Google</span>
								<% } %>
								<% if (currentUser.leagueoflegend.idProfile) { %>
								<span class="label label-info">League of Legend</span>
								<% } %>
								<% if (currentUser.twitter.username) { %>
								<a href="https://www.twitter.com/<%= currentUser.twitter.username %>" title="see <%= user.twitter.username %> on twitter" target="_blank" class="label label-info">Twitter</a>
								<% } %>
								<a href="./settings" title="add an account" class="label label-default">
									<span class="fa fa-plus"></span>
									Add
								</a>
							</div>
							<div class="col-lg-12">
								<h3>Ladders ranking</h3>	
								<table class="table table-striped text-center">
									<thead>
										<tr>
											<th class="text-center">Yesterday's</th>
											<th class="text-center">Last Week</th>
											<th class="text-center">Last Month</th>
										</tr>
									</thead>
									<tbody>
										<tr>
											<td><%= currentUser.dailyRank === 0 ? 'not ranked' : currentUser.dailyRank %></td>
											<td><%= currentUser.weeklyRank === 0 ? 'not ranked' : currentUser.weeklyRank %></td>
											<td><%= currentUser.monthlyRank === 0 ? 'not ranked' : currentUser.monthlyRank %></td>
										</tr>
									</tbody>
								</table>
							</div>

							<div class="col-md-12 col-lg-12">
								<div class="panel graphsTab">
									<div class="tabbable tabs-left clearfix">
										<ul id="tabbyTab" class="nav nav-tabs nav-justified">
											<li class="active"><a href="#xpTab" data-toggle="tab">experience</a></li>
											<li><a href="#levelTab" data-toggle="tab">levels</a></li>
											<li><a href="#ranksTab" data-toggle="tab">Ranks</a></li>
										</ul>
										<div id="tabby" class="tab-content">
											<div class="tab-pane active animated bounceIn" id="xpTab">
												<div class="row">
													<div class="col-lg-12">								
														<canvas id="historygraph" class="c-center"></canvas>	
													</div>
												</div>
											</div>
											<div class="tab-pane animated bounceIn" id="levelTab">
												<div class="row">
													<div class="col-lg-12">								
														<canvas id="levelgraph" class="c-center"></canvas>	
													</div>
												</div>
											</div>
											<div class="tab-pane animated bounceIn" id="ranksTab">
												<div class="row">
													<div class="col-lg-12">								
														<canvas id="ranksgraph" class="c-center"></canvas>	
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
				</div>
				<div class="col-lg-4 badggies">
					<h4>My Badges</h4>
					<section class="badgeList">
						
						<% for (var i = 2; i >= 0; i--) { %>
						<img src="./img/badges/daily_ranked_1.png" class="img-responsive hover-me x2" data-toggle="tooltip" data-placement="bottom" title="Tooltip on left">
						<img src="./img/badges/daily_ranked_2.png" class="img-responsive hover-me x2 " data-toggle="tooltip" data-placement="bottom" title="Tooltip on left">
						<img src="./img/badges/daily_ranked_3.png" class="img-responsive hover-me x2 " data-toggle="tooltip" data-placement="bottom" title="Tooltip on left">
						<img src="./img/badges/friends_10.png" class="img-responsive hover-me x2 " data-toggle="tooltip" data-placement="bottom" title="Tooltip on left">
						<img src="./img/badges/friends_20.png" class="img-responsive hover-me x2" data-toggle="tooltip" data-placement="bottom" title="Tooltip on left">
						<img src="./img/badges/friends_30.png" class="img-responsive hover-me x2" data-toggle="tooltip" data-placement="bottom" title="Tooltip on left">
						<img src="./img/badges/weekly_ranked_1.png" class="img-responsive hover-me x2 " data-toggle="tooltip" data-placement="bottom" title="Tooltip on left">
						<img src="./img/badges/weekly_ranked_2.png" class="img-responsive hover-me x2 " data-toggle="tooltip" data-placement="bottom" title="Tooltip on left">
						<img src="./img/badges/weekly_ranked_3.png" class="img-responsive hover-me x2 " data-toggle="tooltip" data-placement="bottom" title="Tooltip on left">
						<img src="./img/badges/monthly_ranked_1.png" class="img-responsive hover-me x2 " data-toggle="tooltip" data-placement="bottom" title="Tooltip on left">
						<img src="./img/badges/monthly_ranked_2.png" class="img-responsive hover-me x2 " data-toggle="tooltip" data-placement="bottom" title="Tooltip on left">
						<img src="./img/badges/monthly_ranked_3.png" class="img-responsive hover-me x2 " data-toggle="tooltip" data-placement="bottom" title="Tooltip on left">
						<% } %>
					</section>
				</div>
			</div>
			<div class="row">
				<ul class="timeline col-lg-12">
					<% var notif = currentUser.notifications;
					for (var i = notif.length - 1; i >= 0; i--) {
						if(notif[i].persist === true) { 
							var isOdd =  (i % 2) ? 'fadeInLeft' : 'fadeInRight timeline-inverted'
							, type = (notif[i].type == 'challengeSuccess') ? 'success' : ((notif[i].type == 'challengeReceive') ? 'danger' : 'info');
							%>
							<li class="animated <%= isOdd %> ">
								<div class="timeline-badge <%= type %>"><span class="<%= notif[i].icon %>"></span></div>
								<div class="timeline-panel glow-shad ">
									<div class="timeline-heading">
										<h4 class="timeline-title"><%= notif[i].title %></h4>
										<p>
											<small class="text-muted">
												<i class="glyphicon glyphicon-time"></i>
												<span class="timeAgo" data-date="<%= notif[i].date %>"></span>
											</small>
										</p>
									</div>
									<div class="timeline-body">
										<p> <a href="<%= notif[i].link2 %>" ><%= notif[i].to %></a> <%= notif[i].message %></p>
									</div>
								</div>
							</li>
							<% } 
					} %>
				</ul>			
			</div>
		</div>
	</div>

			<%= currentUser.dailyArchives %>
			
	<% include statics/footers %>
	<script type="text/javascript" src="../js/chart.min.js"></script>
	<script type="text/javascript">

		$(function() {

			$(".graphsTab input[type=checkbox]").bootstrapSwitch();
			// return an array composed of a list of the days' number from 1 month ago until today, not included.
			function getAllDays() {
				var e = moment();
				var s = moment().subtract('months', 1);
				var a = [];

				while(s.isBefore(e)) {
					a.push(s.format("MMM - DD"));
					s = s.add('days', 1);
				}
				return a;
			}

			$('.badggies img').hover(function(e){
				$(this).tooltip('show')
			},function(){
				$(this).tooltip('hide')

			})
			
			var meNot = false;
			$('.linked').hover(function(){
				var _this = $(this);
				_this.children('.meany').addClass('hidden');
				_this.children('a').removeClass('hidden');

			}, function(){
				var _this = $(this);
				_this.children('a').addClass('hidden');
				_this.children('.meany').removeClass('hidden');
			});


			// User Xp Historic graph
			var dataLabels = getAllDays();
			var desiredRatio = $("#historygraph").parent().width();
			var canvasXp = $("#historygraph")[0];

			var ctxXp = canvasXp.getContext("2d")
			, dota2 = []
			, warcraft4 = []
			, dailyR = []
			, weeklyR = []
			, monthlyR = []
			, globalR = [];
			canvasXp.setAttribute('width', desiredRatio);
			canvasXp.setAttribute('height', desiredRatio/3);
			var historic = JSON.parse('<%-JSON.stringify(currentUser.xpHistoric)%>').reverse();

			// position our start at the end of the graph by reversing it.
			for (var i = dataLabels.length - 1; i >= 0; i--) {
				// Reverse the value of our historic
				var thisOne = historic[i] ? historic[i].xp : 0;
				var thatOne = historic[i] ? historic[i].level : 0;
				dota2.push(thisOne);
				warcraft4.push(thatOne);
				
			};
			var optionA = {
				scaleStartValue : 50
			}
			var dataXp = {
				labels : dataLabels,
				datasets : [
					{
						fillColor : "rgba(27,63,89,0.3)",
						strokeColor : "rgba(27,63,89,0.6)",
						pointColor : "rgba(27,63,89,0.8)",
						pointStrokeColor : "#fff",
						data : dota2
					}
				]
			}
			new Chart(ctxXp).Line(dataXp,optionA);
			//Level Graph

			var canvasLevel = $("#levelgraph")[0];
			var ctxLevel = canvasLevel.getContext("2d");
			canvasLevel.setAttribute('width', desiredRatio);
			canvasLevel.setAttribute('height', desiredRatio/3);

			var optionB = {
				scaleStartValue : 0
			}
			var dataLevel = {
				labels : dataLabels,
				datasets : [
					{
						fillColor : "rgba(26,56,82,0.3)",
						strokeColor : "rgba(26,56,82,0.6)",
						pointColor : "rgba(26,56,82,0.8)",
						pointStrokeColor : "#fff",
						data : warcraft4
					}
				]
			}
			new Chart(ctxLevel).Line(dataLevel,optionB);

			//Ranks Graph
			var rHistDaily = JSON.parse('<%-JSON.stringify(currentUser.dailyArchives)%>').reverse();

			var canvasRanks = $("#ranksgraph")[0];
			var ctxRanks = canvasRanks.getContext("2d");
			canvasRanks.setAttribute('width', desiredRatio);
			canvasRanks.setAttribute('height', desiredRatio/3);

			for (var i = rHistDaily.length - 1; i >= 0; i--) {
				// Reverse the value of our historic
				var thisOne = rHistDaily[i] ? rHistDaily[i].rank : 0;
				dailyR.push(thisOne);
				
			};
			var optionB = {
				scaleStartValue : 0
			}
			var dataRanks = {
				labels : dataLabels,
				datasets : [
					{
						fillColor : "rgba(245,61,104,0.3)",
						strokeColor : "rgba(245,61,104,0.6)",
						pointColor : "rgba(245,61,104,0.8)",
						pointStrokeColor : "#fff",
						data : ranks
					}
				]
			}
			new Chart(ctxRanks).Line(dataRanks,optionB);

		});

	</script>
</body>
</html>