"use strict";angular.module("caf",["ngRoute","ngResource","ngAnimate","ngStorage","ngTouch","ngTable","ngSanitize","jmdobry.angular-cache","ui.bootstrap","monospaced.elastic","caf.filters","caf.services","api.services","users.services","ladders.services","caf.directives","caf.controllers","login.controllers","users.controllers","ladders.controllers","caf.animations"]).constant("conf",{epApiDev:"http://localhost:8080/",epApi:"http://www.cyf-app.co/"}).config(["$angularCacheFactoryProvider","$routeProvider",function(a,b){a.setCacheDefaults({deleteOnExpire:"aggressive",storageMode:"localStorage"}),b.when("/",{templateUrl:"views/main.html",controller:"mainCtrl"}).when("/leaderboard/",{templateUrl:"views/leaderboard.html",controller:"leaderboardCtrl"}).when("/leaderboard/:type",{templateUrl:"views/leaderboard.html",controller:"leaderboardCtrl"}).when("/signup",{templateUrl:"views/signup.html",controller:"mainCtrl"}).when("/login",{templateUrl:"views/partials/login.html",controller:"loginCtrl"}).when("/logout",{templateUrl:"views/main.html",controller:"logoutCtrl"}).when("/challenges",{templateUrl:"views/challenges.html",controller:"mainCtrl"}).when("/users",{templateUrl:"views/users.html",controller:"usersCtrl"}).when("/users/:userId",{templateUrl:"views/user_detail.html",controller:"usersCtrl"}).when("/friends",{templateUrl:"views/friends.html",controller:"friendsCtrl",authRequired:!0}).when("/settings",{templateUrl:"views/settings.html",controller:"mainCtrl",authRequired:!0}).when("/request",{templateUrl:"views/requests.html",controller:"mainCtrl",authRequired:!0}).when("/launchChallenge",{templateUrl:"views/launchChallenge.html",controller:"mainCtrl",authRequired:!0}).when("/ongoing",{templateUrl:"views/ongoing.html",controller:"mainCtrl",authRequired:!0}).when("/myChallenges",{templateUrl:"views/myChallenges.html",controller:"mainCtrl",authRequired:!0}).when("/rateChallenges",{templateUrl:"views/rateChallenges.html",controller:"mainCtrl",authRequired:!0}).when("/tribunal",{templateUrl:"views/tribunal.html",controller:"mainCtrl",authRequired:!0}).when("/profile",{templateUrl:"views/profile.html",controller:"profile",authRequired:!0}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location","$anchorScroll","$localStorage","$http","$routeParams","$angularCacheFactory",function(a,b,c,d,e,f,g){e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded",e.defaults.headers.put["Content-Type"]="application/x-www-form-urlencoded",e.defaults.headers.common["X-cyf-AuthToken"]=d.sessionKey,a.$on("$routeChangeStart",function(a,c){document.getElementById("app-slider").classList.remove("slider-active"),c.authRequired!==!0||d.sessionKey||(console.log("This route requires authentication"),b.path("/"))}),a.cacheLadders=g("leaderboardCache"),a.cacheUsers=g("usersCache"),a.$on("$routeChangeSuccess",function(){b.hash(f.scrollTo),c()})}]),angular.module("caf.services",[]).value("version","0.1"),angular.module("users.services",[]).factory("Users",["conf","$resource",function(a,b){return b(a.epApi+"app/users/:userId",{},{query:{method:"GET",params:{userId:""},isArray:!0}})}]),angular.module("ladders.services",[]).factory("Ladders",["conf","$resource",function(a,b){return b(a.epApi+"ladder/:type/:scope",{},{get:{method:"GET",dataType:"json",params:{type:"@type",scope:"@scope"},isArray:!0}})}]),angular.module("api.services",[]).factory("apiService",["conf","$resource",function(a,b){return{Auth:b(a.epApi+"auth/:email/:pass",{},{query:{method:"GET",dataType:"json",params:{email:!1,pass:!1}}}),Signup:b(a.epApiDev+"api/register/:username/:email/:pass",{},{post:{method:"POST",dataType:"json",params:{username:"@username",email:"@email",pass:"@pass"}}})}}]),angular.module("caf.controllers",[]).controller("mainCtrl",["$scope",function(a){a.pageTitle="Welcome"}]).controller("profile",["$scope","$routeParams","$angularCacheFactory","Users",function(a,b,c){c.get("profileCache");a.pageTitle="My profile"}]).controller("MenuLeftCtrl",["$location","$localStorage","$modal","$scope",function(a,b,c,d){d.currentUser=b.profile?b.profile:!1,d.location=a,d.modal=c}]),angular.module("login.controllers",[]).controller("logoutCtrl",["conf","$rootScope","$scope","$location","$resource","$routeParams","$http","$localStorage",function(a,b,c,d,e,f,g,h){delete g.defaults.headers.common["X-cyf-AuthToken"],delete h.profile,delete h.sessionKey,h.$reset(),b.currentUser=!1,d.path("/")}]).controller("loginCtrl",["$http","$location","$modal","$modalInstance","$localStorage","$rootScope","$scope","apiService",function(a,b,c,d,e,f,g,h){function i(b){if(b.user&&b.user.sessionKey){a.defaults.headers.common["X-cyf-AuthToken"]=b.user.sessionKey;try{e.profile=b.user,e.sessionKey=b.user.sessionKey,d.close(),f.currentUser=e.profile}catch(c){console.log(c)}}}function j(b){g.state.progress=!1,a.defaults.headers.common["X-cyf-AuthToken"]="",delete e.profile,delete e.sessionKey,console.log(b.err?b.err:b.status?b.status:"other error")}g.state={progress:!1},g.form={},g.login=function(){g.form.login.$valid&&(g.state.progress=!0,h.Auth.get({email:g.form.login.email,pass:g.form.login.pass},function(a){a.passed===!0?i(a):j(a)},function(a){j(a)}))},g.signup=function(){g.form.register.$valid&&(g.state.progress=!0,h.Signup.post({username:g.form.register.username,email:g.form.register.email,pass:g.form.register.pass},function(a){console.log(a),a.passed===!0?a.log===!0?i(a):(d.close(),c.open({templateUrl:"views/partials/emailConfirm.html"})):j(a)},function(a){j(a)}))},g.cancel=function(){d.dismiss("cancel")},g.tabSelect=function(a){g.tabIndex=a}}]),angular.module("users.controllers",["jmdobry.angular-cache"]).controller("usersCtrl",["$rootScope","$scope","$routeParams","$angularCacheFactory","Users",function(a,b,c,d,e){var f=c.userId?c.userId:!1;if(f){var g=a.cacheUsers,h=g.get("users_"+f);if(!h||!h.idCool)return console.log("load from api"),e.get({userId:f},function(a){g.put("users_"+a.idCool,a),b.pageTitle=a.local.pseudo+"'s profile",b.user=a},function(a){console.log(a)});console.log("load from cache"),b.pageTitle=h.local.pseudo+"'s profile",b.user=h}else b.pageTitle="Challenger list",b.users=e.query()}]).controller("friendsCtrl",["$scope","$routeParams","$localStorage",function(a,b,c){a.pageTitle="My friends";var d=c.profile?c.profile:!1;console.log(d),a.currentUser=d}]),angular.module("ladders.controllers",[]).controller("leaderboardCtrl",["$scope","$rootScope","$routeParams","$angularCacheFactory","Ladders","ngTableParams",function(a,b,c,d,e,f){function g(b){a.tableParams=new f({page:1,count:5},{total:b.length,getData:function(a,c){a.resolve(b.slice((c.page()-1)*c.count(),c.page()*c.count()))}})}var h=c.type?c.type:!1,i=b.cacheLadders,j=i.get("ladderGlobal"),k=i.get("ladder"+h);return a.type=h?h:"global",a.pageTitle=h?h+" ladder":"Global leaderboard",h===!1?j&&j.length>0?(console.log("Load from cache"),g(j)):e.query({type:"score",scope:"global"},function(a){return console.log("Load from API"),console.log(a),i.put("ladderGlobal",a),g(a)},function(a){return console.log(a)}):k&&k.length>0?(console.log("Load from cache"),g(k)):e.get({type:"score",scope:h},function(a){return console.log("Load from API"),console.log(a),i.put("ladder"+h,a),g(a)},function(a){return console.log(a)})}]);var cafAnimations=angular.module("caf.animations",["ngAnimate"]);angular.module("caf.filters",[]).filter("interpolate",["version",function(a){return function(b){return String(b).replace(/\%VERSION\%/gm,a)}}]),angular.module("caf.directives",[]).directive("appVersion",["version",function(a){return function(b,c){c.text(a)}}]).directive("menuLeft",function(){return{templateUrl:"views/partials/menuleft.html",restrict:"AE",controller:"MenuLeftCtrl"}}).directive("scrollTo",["$location","$anchorScroll",function(a,b){return function(c,d,e){d.bind("click",function(c){c.stopPropagation();var d=e.scrollTo,f=a.hash();a.hash(d),b(),a.hash(f)})}}]);